<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ãƒ¡ãƒªã‚«ä¸»è¦éƒ½å¸‚ ä½ç½®å½“ã¦ã‚¯ã‚¤ã‚º</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f4f4f4;
            height: 100vh;
        }

        header {
            background-color: #333;
            color: white;
            width: 100%;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        #game-info {
            display: flex;
            justify-content: space-between;
            width: 90%;
            max-width: 1000px;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        #question-box {
            font-size: 1.2rem;
            font-weight: bold;
            color: #d32f2f;
        }

        #score-box {
            font-size: 1.1rem;
        }

        #map-container {
            width: 90%;
            max-width: 1000px;
            height: 65vh; /* ç”»é¢ã®é«˜ã•ã®65% */
            border: 2px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
            border-radius: 6px;
        }

        #message {
            margin-top: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            height: 1.5em;
        }

        .correct-msg { color: green; }
        .wrong-msg { color: red; }

        button#restart-btn {
            margin-top: 15px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            display: none; /* æœ€åˆã¯éè¡¨ç¤º */
        }
        button#restart-btn:hover {
            background-color: #0056b3;
        }

        /* ã‚¹ãƒãƒ›å‘ã‘ã®èª¿æ•´ */
        @media (max-width: 600px) {
            #game-info { flex-direction: column; text-align: center; }
            #question-box { margin-bottom: 5px; }
            #map-container { height: 60vh; }
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ‡ºğŸ‡¸ ã‚¢ãƒ¡ãƒªã‚«ä¸»è¦éƒ½å¸‚ ä½ç½®å½“ã¦ã‚¯ã‚¤ã‚º</h1>
</header>

<div id="game-info">
    <div id="question-box">å‡ºé¡Œ: <span id="current-city-name">---</span></div>
    <div id="score-box">æ­£è§£æ•°: <span id="score">0</span> / <span id="total">0</span></div>
</div>

<div id="message"></div>

<div id="map-container">
    <div id="map"></div>
</div>

<button id="restart-btn" onclick="restartGame()">ã‚‚ã†ä¸€åº¦éŠã¶</button>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // éƒ½å¸‚ãƒ‡ãƒ¼ã‚¿ï¼ˆç·¯åº¦ãƒ»çµŒåº¦ï¼‰
    const citiesData = [
        { name: "ã‚·ã‚¢ãƒˆãƒ«", lat: 47.6062, lng: -122.3321 },
        { name: "ã‚µãƒ³ãƒ•ãƒ©ãƒ³ã‚·ã‚¹ã‚³", lat: 37.7749, lng: -122.4194 },
        { name: "ãƒ©ã‚¹ãƒ™ã‚¬ã‚¹", lat: 36.1699, lng: -115.1398 },
        { name: "ãƒ­ã‚µãƒ³ã‚¼ãƒ«ã‚¹", lat: 34.0522, lng: -118.2437 },
        { name: "ã‚µãƒ³ãƒ‡ã‚£ã‚¨ã‚´", lat: 32.7157, lng: -117.1611 },
        { name: "ã‚µãƒ³ãƒã‚¼", lat: 37.3382, lng: -121.8863 },
        { name: "ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹", lat: 33.4484, lng: -112.0740 },
        { name: "ã‚¨ãƒ«ãƒ‘ã‚½", lat: 31.7619, lng: -106.4850 },
        { name: "ãƒ€ãƒ©ã‚¹", lat: 32.7767, lng: -96.7970 },
        { name: "ãƒ’ãƒ¥ãƒ¼ã‚¹ãƒˆãƒ³", lat: 29.7604, lng: -95.3698 },
        { name: "ãƒ‹ãƒ¥ãƒ¼ã‚ªãƒ¼ãƒªãƒ³ã‚º", lat: 29.9511, lng: -90.0715 },
        { name: "ãƒã‚¤ã‚¢ãƒŸ", lat: 25.7617, lng: -80.1918 },
        { name: "ã‚¢ãƒˆãƒ©ãƒ³ã‚¿", lat: 33.7490, lng: -84.3880 },
        { name: "ã‚»ãƒ³ãƒˆãƒ«ã‚¤ã‚¹", lat: 38.6270, lng: -90.1994 },
        { name: "ã‚·ã‚«ã‚´", lat: 41.8781, lng: -87.6298 },
        { name: "ãƒ‡ãƒˆãƒ­ã‚¤ãƒˆ", lat: 42.3314, lng: -83.0458 },
        { name: "ãƒ”ãƒƒãƒ„ãƒãƒ¼ã‚°", lat: 40.4406, lng: -79.9959 },
        { name: "ãƒœã‚¹ãƒˆãƒ³", lat: 42.3601, lng: -71.0589 },
        { name: "ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯", lat: 40.7128, lng: -74.0060 },
        { name: "ãƒ•ã‚£ãƒ©ãƒ‡ãƒ«ãƒ•ã‚£ã‚¢", lat: 39.9526, lng: -75.1652 },
        { name: "ãƒœãƒ«ãƒ†ã‚£ãƒ¢ã‚¢", lat: 39.2904, lng: -76.6122 },
        { name: "ãƒ¯ã‚·ãƒ³ãƒˆãƒ³DC", lat: 38.9072, lng: -77.0369 }
    ];

    let map;
    let markers = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let questionOrder = [];
    let canClick = true;

    // ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–
    function initGame() {
        // åœ°å›³ã®è¡¨ç¤ºï¼ˆã‚¢ãƒ¡ãƒªã‚«å…¨ä½“ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«èª¿æ•´ï¼‰
        map = L.map('map').setView([39.8283, -98.5795], 4);

        // åœ°å›³ã‚¿ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ï¼ˆOpenStreetMapã‚’ä½¿ç”¨ï¼‰
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // å…¨éƒ½å¸‚ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¨­ç½®
        citiesData.forEach((city, index) => {
            const marker = L.marker([city.lat, city.lng]).addTo(map);
            
            // ãƒãƒ¼ã‚«ãƒ¼ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
            marker.on('click', function() {
                checkAnswer(city.name, this);
            });

            // ãƒãƒ¼ã‚«ãƒ¼ã«éƒ½å¸‚ãƒ‡ãƒ¼ã‚¿ã‚’ç´ä»˜ã‘
            marker.cityName = city.name;
            markers.push(marker);
        });

        startQuiz();
    }

    // ã‚¯ã‚¤ã‚ºé–‹å§‹å‡¦ç†
    function startQuiz() {
        score = 0;
        currentQuestionIndex = 0;
        document.getElementById('restart-btn').style.display = 'none';
        
        // å‡ºé¡Œé †ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
        questionOrder = [...citiesData].sort(() => Math.random() - 0.5);
        
        updateScoreBoard();
        showNextQuestion();
    }

    // æ¬¡ã®å•é¡Œã‚’è¡¨ç¤º
    function showNextQuestion() {
        if (currentQuestionIndex >= questionOrder.length) {
            endGame();
            return;
        }

        canClick = true;
        const targetCity = questionOrder[currentQuestionIndex];
        document.getElementById('current-city-name').textContent = targetCity.name;
        document.getElementById('message').textContent = "åœ°å›³ä¸Šã®ãƒ”ãƒ³ã‚’é¸ã‚“ã§ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„";
        document.getElementById('message').className = "";
    }

    // ç­”ãˆåˆã‚ã›
    function checkAnswer(clickedCityName, marker) {
        if (!canClick) return;

        const targetCity = questionOrder[currentQuestionIndex];
        const messageEl = document.getElementById('message');

        if (clickedCityName === targetCity.name) {
            // æ­£è§£
            messageEl.textContent = `æ­£è§£ï¼ ã“ã‚Œã¯ ${clickedCityName} ã§ã™ã€‚`;
            messageEl.className = "correct-msg";
            score++;
            
            // æ­£è§£ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º
            marker.bindPopup(`<b>${clickedCityName}</b><br>æ­£è§£ï¼`).openPopup();
            
            canClick = false;
            setTimeout(() => {
                marker.closePopup();
                currentQuestionIndex++;
                updateScoreBoard();
                showNextQuestion();
            }, 1500); // 1.5ç§’å¾Œã«æ¬¡ã®å•é¡Œã¸

        } else {
            // ä¸æ­£è§£
            messageEl.textContent = `æ®‹å¿µ... ãã‚Œã¯ ${clickedCityName} ã§ã™ã€‚æ­£è§£ã¯ ${targetCity.name} ã§ã—ãŸã€‚`;
            messageEl.className = "wrong-msg";
            
            // é–“é•ãˆãŸå ´æ‰€ã®åå‰ã‚’è¡¨ç¤º
            marker.bindPopup(`<b>${clickedCityName}</b><br>ä¸æ­£è§£`).openPopup();

            canClick = false;
            // æ­£è§£ã®å ´æ‰€ã‚’å°‘ã—æ•™ãˆã¦ã‚ã’ã‚‹ï¼ˆåœ°å›³ã‚’ç§»å‹•ã—ã€æ­£è§£ã®ãƒãƒ¼ã‚«ãƒ¼ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼‰
            const correctMarker = markers.find(m => m.cityName === targetCity.name);
            
            setTimeout(() => {
                marker.closePopup(); // é–“é•ãˆãŸæ–¹ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
                // æ­£è§£ã®å ´æ‰€ã¸ãƒ‘ãƒ³ï¼ˆç§»å‹•ï¼‰
                // map.panTo(correctMarker.getLatLng()); // é›£æ˜“åº¦ã‚’ä¸‹ã’ã‚‹ãªã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã™
                correctMarker.bindPopup(`<b>${targetCity.name}</b><br>ã“ã“ãŒæ­£è§£ã§ã—ãŸ`).openPopup();
                
                setTimeout(() => {
                    correctMarker.closePopup();
                    currentQuestionIndex++;
                    updateScoreBoard();
                    showNextQuestion();
                }, 2000);
            }, 1000);
        }
    }

    // ã‚¹ã‚³ã‚¢è¡¨ç¤ºæ›´æ–°
    function updateScoreBoard() {
        document.getElementById('score').textContent = score;
        document.getElementById('total').textContent = questionOrder.length;
    }

    // ã‚²ãƒ¼ãƒ çµ‚äº†
    function endGame() {
        document.getElementById('question-box').textContent = "çµ‚äº†ï¼";
        document.getElementById('message').textContent = `ã‚ãªãŸã®ã‚¹ã‚³ã‚¢ã¯ ${score} / ${citiesData.length} ã§ã—ãŸï¼`;
        document.getElementById('message').className = "";
        document.getElementById('restart-btn').style.display = 'block';
    }

    function restartGame() {
        // ãƒãƒ¼ã‚«ãƒ¼ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’å…¨ã¦é–‰ã˜ã‚‹
        map.closePopup();
        startQuiz();
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
    window.onload = initGame;

</script>

</body>
</html>
